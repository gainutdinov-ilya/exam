{% extends "base.html" %}
{% block content %}
    <table>
        <tr>
            <td>
                Дата заказа
            </td>
            <td>
                Статус
            </td>
        </tr>
        {% for order in orders %}
            <tr>
                <td>
                    {{ order.orderTime }}
                </td>
                <td>
                    {{ order.get_status_display  }}
                    {% if order.status == 'new' %}
                        <button onclick="cancel({{ order.pk }})">Отменить</button>
                    {% endif %}
                </td>
                <td>
                    <table>
                        <tr>
                            <td>
                                Название
                            </td>
                            <td>
                                Кол-во
                            </td>
                            <td>
                                Цена за ед.
                            </td>
                        </tr>

                        {% for item in order.items.all %}
                            <tr>
                                <td>
                                    {{ item.product.label }}
                                </td>
                                <td>
                                    {{ item.count }}
                                </td>
                                <td>
                                    {{ item.price }}
                                </td>
                            </tr>
                        {% endfor %}

                    </table>
                </td>
            </tr>
        {% endfor %}
    </table>
    <script type="text/javascript">
    async function cancel(id){
        await fetch('/api/order/cancel/'.concat(id)).then( () => document.location.reload())
    }
    </script>
{% endblock %}